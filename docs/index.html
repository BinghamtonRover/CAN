<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BURT_can: Firmware Utilities</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BURT_can<span id="projectnumber">&#160;1.0.0</span>
   </div>
   <div id="projectbrief">Handles sending and receiving messages using the CAN protocol for the Binghamton University Rover Team&#39;s subsystems.</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Firmware Utilities </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> This repository contains all the common code you'll need to write firmware sketches for the rover.</p>
<ul>
<li><b>Protobuf</b>: All the rover's data and commands are serialized using Google's <a href="https://protobuf.dev/">Protocol Buffers</a></li>
<li><b>CAN bus</b>: The Teensy boards communicate with the Raspberry Pi using the <a href="https://www.csselectronics.com/pages/can-bus-simple-intro-tutorial">CAN bus protocol</a></li>
<li><b>Serial</b>: While the firmware are supposed to be controlled by the Raspberry Pi, they can also be unit tested with the dashboard by passing Protobuf messages over a USB Serial connection.</li>
</ul>
<p >Each library is documented, required dependencies are bundled for your convenience, and there is a full example combining everything you'll need in the <a href="https://github.com/BinghamtonRover/Firmware-Template">Firmware-Template</a> repository.</p>
<p >To install and use this library, run <code>sync.sh</code> (or <code>sync.bat</code> on Windows) with the path of your Arduino Sketchbook directory. You can find this by going into <code>File &gt; Preferences</code> in your Arduino IDE. That script will create a <a href="https://stackoverflow.com/q/185899/9392211">hard link</a> to this repository in your Arduino installation's <a href="https://docs.arduino.cc/software/ide-v1/tutorials/installing-libraries#manual-installation">libraries</a> directory.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Protobuf</h1>
<p >Just as JSON can turn a C++ struct or a Python class into a language-agnostic string that can be passed between programs, Protobuf also encodes and decodes data between languages. The advantages of Protobuf over JSON are:</p>
<ol type="1">
<li>A much smaller format. Protobuf only encodes the fields it needs, whereas JSON encodes every field. Also, Protobuf is not designed to be human-readable, which means it doesn't have to waste space on characters like <code>{</code>, <code>"&lt;/tt&gt;, or &lt;tt&gt;,&lt;/tt&gt;.
2. Protobuf data is defined in a special &lt;tt&gt;.proto&lt;/tt&gt; file, and the Protobuf compiler, &lt;tt&gt;protoc&lt;/tt&gt;, automatically generates classes or structs in the language of your choice, with encoding/decoding methods for you. 
3. Because code is generated for you, you never have to worry about keeping your data in sync between languages, or whether your encoding/decoding logic is sound. 

You'll need to install Google's Protobuf compiler &lt;a href="<a href="https://github.com/protocolbuffers/protobuf/releases/latest">https://github.com/protocolbuffers/protobuf/releases/latest</a>" &gt;here&lt;/a&gt;. For C++, you only need to download the &lt;tt&gt;protoc&lt;/tt&gt; files for your platform &amp;ndash; the runtime libraries are bundled here for you. Once downloaded, extract the files and put them in your PATH.

The original Protobuf compiler is not fit for use within Arduino. Instead, we will use a different compiler called &lt;tt&gt;nanopb&lt;/tt&gt;.

@code{bash} 
# Make sure you have Python before running this command
python -m pip install nanopb
@endcode

All our Protobuf files are stored within the &lt;a href="<a href="https://github.com/BinghamtonRover/Protobuf">https://github.com/BinghamtonRover/Protobuf</a>" &gt;Protobuf&lt;/a&gt; repository.

@section autotoc_md2 CAN Bus

Protobuf defines a format for how to represent our data, but we still need a method of sending that data. The dashboard uses a UDP connection over Ethernet, but the Teensy boards are too small for that. Instead, we use the widely-popular Controller Area Network (CAN), specifically designed for use within vehicles. The basic idea of a CAN bus is that all devices are connected to the same network (along the “bus”), and each message is packaged with an ID that specifies the intended recipient and purpose. 

The link above is very user-friendly; a more technical document can be found &lt;a href="<a href="https://www.ti.com/lit/an/sloa101b/sloa101b.pdf">https://www.ti.com/lit/an/sloa101b/sloa101b.pdf</a>" &gt;here&lt;/a&gt;. Unfortunately, CAN only allows 8 bytes per packet, which is too small to accommodate most useful Protobuf messages. We are hoping to switch to &lt;a href="<a href="https://www.csselectronics.com/pages/can-fd-flexible-data-rate-intro">https://www.csselectronics.com/pages/can-fd-flexible-data-rate-intro</a>" &gt;CAN FD, which allows up to 64 bytes per packet, which is more than enough to fit all our Protobuf messages.</code></li>
</ol>
<p ><code></code></p>
<h1><a class="anchor" id="autotoc_md3"></a>
Serial</h1>
<p ><code> Writing custom C++ code to test each aspect of the firmware can get tiresome, and it may difficult for non-software members to set up our libraries, repositories, and submodules. Instead, we’ll use the Dashboard to send commands to the Teensy boards directly over Serial. The <code>BURT_serial</code> library allows you to handle any incoming commands by specifying a callback function to handle it. You don’t have to be connected to the Dashboard to run your code – you can still use the <code>BURT_can</code> library to receive commands as normal. But you won’t be able to use the Serial Monitor when using this library, either. </code></p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
